generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ct_entidad {
  id_ct_entidad    Int            @id @default(autoincrement())
  nombre           String         @unique(map: "nombre") @db.VarChar(100)
  abreviatura      String         @db.VarChar(10)
  estado           Boolean?       @default(true)
  fecha_in         DateTime       @default(now()) @db.DateTime(0)
  fecha_up         DateTime?      @db.DateTime(0)
  id_ct_usuario_in Int
  id_ct_usuario_up Int?
  ct_municipio     ct_municipio[]
}

model ct_infraestructura_anexo {
  id_ct_infraestructura_anexo Int       @id @default(autoincrement())
  nombre                      String    @db.VarChar(255)
  estado                      Boolean?  @default(true)
  fecha_in                    DateTime  @default(now()) @db.DateTime(0)
  fecha_up                    DateTime? @db.DateTime(0)
  id_ct_usuario_in            Int
  id_ct_usuario_up            Int?
}

model ct_infraestructura_area {
  id_ct_infraestructura_area Int       @id @default(autoincrement())
  nombre                     String    @db.VarChar(255)
  estado                     Boolean?  @default(true)
  fecha_in                   DateTime  @default(now()) @db.DateTime(0)
  fecha_up                   DateTime? @db.DateTime(0)
  id_ct_usuario_in           Int
  id_ct_usuario_at           Int?
}

model ct_infraestructura_departamento {
  id_ct_infraestructura_departamento Int       @id @default(autoincrement())
  nombre                             String    @db.VarChar(255)
  estado                             Boolean?  @default(true)
  fecha_in                           DateTime  @default(now()) @db.DateTime(0)
  fecha_up                           DateTime? @db.DateTime(0)
  id_ct_usuario_in                   Int
  id_ct_usuario_up                   Int?
}

model ct_infraestructura_direccion {
  id_ct_infraestructura_direccion Int       @id @default(autoincrement())
  nombre                          String    @db.VarChar(255)
  estado                          Boolean?  @default(true)
  fecha_in                        DateTime  @default(now()) @db.DateTime(0)
  fecha_up                        DateTime? @db.DateTime(0)
  id_ct_usuario_in                Int
  id_ct_usuario_at                Int?
}

model ct_infraestructura_jefe_sector {
  id_ct_jefe_sector Int          @id @default(autoincrement())
  nombre            String       @db.VarChar(255)
  cct               String       @db.VarChar(11)
  calle             String       @db.VarChar(255)
  numero_exterior   String       @db.VarChar(255)
  id_ct_localidad   Int          @default(0)
  colonia           String       @db.VarChar(50)
  codigo_postal     Int
  latitud           Float        @db.Float
  longitud          Float        @db.Float
  estado            Boolean?     @default(true)
  fecha_in          DateTime     @default(now()) @db.DateTime(0)
  fecha_up          DateTime?    @db.DateTime(0)
  id_ct_usuario_in  Int
  id_ct_usuario_up  Int?
  ct_localidad      ct_localidad @relation(fields: [id_ct_localidad], references: [id_ct_localidad], onDelete: NoAction, onUpdate: NoAction, map: "FK_ct_infraestructura_jefe_sector_ct_localidad")

  @@index([id_ct_localidad], map: "id_ct_localidad")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model ct_infraestructura_supervisor {
  id_ct_supervisor Int
  nombre           String       @db.VarChar(255)
  cct              String       @db.VarChar(11)
  calle            String       @db.VarChar(255)
  numero_exterior  String       @db.VarChar(255)
  id_ct_localidad  Int          @default(0)
  colonia          String       @db.VarChar(50)
  codigo_postal    Int
  latitud          Float        @db.Float
  longitud         Float        @db.Float
  estado           Boolean?     @default(true)
  fecha_in         DateTime     @default(now()) @db.DateTime(0)
  fecha_up         DateTime?    @db.DateTime(0)
  id_ct_usuario_in Int
  id_ct_usuario_up Int?
  ct_localidad     ct_localidad @relation(fields: [id_ct_localidad], references: [id_ct_localidad], onDelete: NoAction, onUpdate: NoAction, map: "FK_ct_infraestructura_supervisor_ct_localidad")

  @@index([id_ct_localidad], map: "FK_ct_infraestructura_supervisor_ct_localidad")
  @@ignore
}

model ct_infraestructura_unidad {
  id_ct_unidad        Int          @id @default(autoincrement())
  id_escuela_Plantel  Int          @default(0)
  id_ct_tipo_escuela  Int          @default(0)
  cct                 String       @db.VarChar(11)
  nombre              String       @db.VarChar(255)
  calle               String       @db.VarChar(255)
  numero_exterior     String       @db.VarChar(255)
  numero_interior     String       @db.VarChar(255)
  id_ct_localidad     Int          @default(0)
  colonia             String       @db.VarChar(50)
  codigo_postal       Int
  latitud             Float        @db.Float
  longitud            Float        @db.Float
  id_ct_sostenimiento Float        @db.Float
  estado              Boolean?     @default(true)
  fecha_in            DateTime     @default(now()) @db.DateTime(0)
  fecha_up            DateTime?    @db.DateTime(0)
  id_ct_usuario_in    Int
  id_ct_usuario_up    Int?
  ct_localidad        ct_localidad @relation(fields: [id_ct_localidad], references: [id_ct_localidad], onDelete: NoAction, onUpdate: NoAction, map: "FK_ct_infraestructura_unidad_ct_localidad")

  @@index([id_ct_localidad], map: "FK_ct_infraestructura_unidad_ct_localidad")
}

model ct_localidad {
  id_ct_localidad                Int                              @id @default(autoincrement())
  nombre                         String                           @db.VarChar(150)
  ambito                         String                           @db.Char(1)
  id_ct_municipio                Int
  estado                         Boolean?                         @default(true)
  fecha_in                       DateTime                         @default(now()) @db.DateTime(0)
  fecha_up                       DateTime?                        @db.DateTime(0)
  id_ct_usuario_in               Int
  id_ct_usuario_up               Int?
  ct_infraestructura_jefe_sector ct_infraestructura_jefe_sector[]
  ct_infraestructura_supervisor  ct_infraestructura_supervisor[]  @ignore
  ct_infraestructura_unidad      ct_infraestructura_unidad[]
  ct_municipio                   ct_municipio                     @relation(fields: [id_ct_municipio], references: [id_ct_municipio], onDelete: NoAction, onUpdate: NoAction, map: "FK_ct_localidad_ct_municipio")

  @@index([id_ct_municipio], map: "ct_localidad_id_ct_municipio_fkey")
}

model ct_municipio {
  id_ct_municipio  Int            @id @default(autoincrement())
  cve_mun          String         @db.VarChar(3)
  nombre           String         @db.VarChar(100)
  id_ct_entidad    Int
  estado           Boolean?       @default(true)
  fecha_in         DateTime       @default(now()) @db.DateTime(0)
  fecha_up         DateTime?      @db.DateTime(0)
  id_ct_usuario_in Int
  id_ct_usuario_up Int?
  ct_localidad     ct_localidad[]
  ct_entidad       ct_entidad     @relation(fields: [id_ct_entidad], references: [id_ct_entidad], onDelete: NoAction, onUpdate: NoAction, map: "FK_ct_municipio_ct_entidad")

  @@index([id_ct_entidad], map: "ct_municipio_id_ct_entidad_fkey")
}

model ct_rate_limit {
  id_ct_rate_limit String    @id @db.VarChar(36)
  identificador    String    @db.VarChar(255)
  endpoint         String    @db.VarChar(100)
  intentos         Int       @default(1)
  ventana_inicio   DateTime  @default(now()) @db.DateTime(6)
  bloqueado_hasta  DateTime? @db.DateTime(6)

  @@index([bloqueado_hasta])
  @@index([identificador, endpoint])
  @@index([ventana_inicio])
}

model ct_refresh_token {
  id_ct_refresh_token String     @id @db.VarChar(36)
  id_ct_usuario       Int
  token_hash          String     @unique @db.VarChar(255)
  id_ct_sesion        String?    @db.VarChar(36)
  fecha_creacion      DateTime   @default(now()) @db.DateTime(6)
  fecha_expiracion    DateTime   @db.DateTime(6)
  fecha_uso           DateTime?  @db.DateTime(6)
  usado               Boolean    @default(false)
  revocado            Boolean    @default(false)
  motivo_revocacion   String?    @db.VarChar(100)
  ct_usuario          ct_usuario @relation(fields: [id_ct_usuario], references: [id_ct_usuario], onDelete: Cascade)

  @@index([fecha_expiracion])
  @@index([id_ct_usuario])
  @@index([revocado])
  @@index([token_hash])
  @@index([usado])
}

model ct_sesion {
  id_ct_sesion     String     @id @db.VarChar(36)
  id_ct_usuario    Int
  jti              String     @unique @db.VarChar(36)
  ip_origen        String?    @db.VarChar(45)
  user_agent       String?    @db.VarChar(500)
  dispositivo      String?    @db.VarChar(100)
  ubicacion        String?    @db.VarChar(100)
  fecha_creacion   DateTime   @default(now()) @db.DateTime(6)
  fecha_expiracion DateTime   @db.DateTime(6)
  fecha_ultimo_uso DateTime?  @db.DateTime(6)
  activa           Boolean    @default(true)
  ct_usuario       ct_usuario @relation(fields: [id_ct_usuario], references: [id_ct_usuario], onDelete: Cascade)

  @@index([activa])
  @@index([fecha_expiracion])
  @@index([id_ct_usuario])
  @@index([jti])
}

model ct_usuario {
  id_ct_usuario      Int                @id @default(autoincrement())
  usuario            String             @unique(map: "IDX_daaab6a989ac4c341e57f18bbe") @db.VarChar(100)
  contrasena         String             @db.VarChar(255)
  estado             Boolean            @default(true)
  fecha_registro     DateTime?          @default(now()) @db.DateTime(6)
  fecha_modificacion DateTime?          @db.DateTime(6)
  uuid_usuario       String             @unique @db.VarChar(36)
  email              String?            @unique @db.VarChar(255)
  ultimo_login       DateTime?          @db.DateTime(6)
  intentos_fallidos  Int                @default(0)
  bloqueado_hasta    DateTime?          @db.DateTime(6)
  ct_refresh_token   ct_refresh_token[]
  ct_sesion          ct_sesion[]
}
